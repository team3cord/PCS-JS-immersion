#!/usr/bin/env node
var jsiGame = require('jsi-gamelib');
var prompt = require('prompt');
var gameMap = require('./game.json');
var getLocation = require('./location');
var getMessage = require('./message');

var jsonMap = gameMap.rooms;
console.log('');
console.log('');
console.log('Come and test your wits against the AMAZING MAZE!');

// WHY DOESN'T THIS WORK!!! 
var key = 1;
var value = 'north';
var obj = jsonMap[1];
console.log((gameMap.rooms[key].value)); // undefined  
console.log(jsonMap[1].value);  // undefined  
console.log(jsonMap[key].north); //  E 
console.log(obj[value]); // E

// WHY DOESN'T THIS WORK!!! 


// START FUNCTION  
playerStatus('B');

// MAIN EVAL AND MOVEMENT functions  
function playerStatus(room){
returnMaze();
getMessage.msgCurrentRoom(room);
evalOptions(room);
}
function evalOptions(room){
//console.log(gameMap.rooms);
  var roomsArray = gameMap.rooms;
  roomsArray.forEach(function(el,ind,ra){
     if((roomsArray[ind].treasure) && (roomsArray[ind].name === room)){
      getMessage.msgWinner(room);
      getMessage.msgPlayAgain();
      playerStatus('B');
     }
  });
  promptMove(room);
}
function promptMove(room){
  prompt.start();
  getMessage.msgWhichDirection(); 
  prompt.get(['direction'], function (err, result){
    getMessage.msgLogMove(result.direction);
    evalAndMove(result.direction, room);
  });
}
function evalAndMove(nextRoom, room){
  console.log(nextRoom + '  ' + room);
  switch(nextRoom){
    case 'N':
      checkMove('north', nextRoom , room);
      break;
    case 'S':
      checkMove('south', nextRoom , room);
      break;
    case 'E':
      checkMove('east', nextRoom , room);
      break;
    case 'W':
      checkMove('west', nextRoom , room);
      break;
    default:  
      console.log(room);
  }

}
function denyAndReprompt(room){

}


// HELPER functions  

function returnMaze(){
  console.log('');
  console.log('');
  console.log(jsiGame.map(gameMap));
  console.log('');
  console.log('');
}
function checkMove(direction, nextRoom , room){
  var anotherRoomsArray = gameMap.rooms;
  anotherRoomsArray.forEach(function(el,ind,ra){
    var arrayObj = anotherRoomsArray[ind];

    if(((arrayObj["name"]) === room) && ((arrayObj[direction]) !== null)) {
        console.log('both true');
        playerStatus(arrayObj[direction]);
        
    }
  });
}



